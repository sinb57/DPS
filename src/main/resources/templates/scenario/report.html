<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en" dir="ltr">

<th:block th:replace="fragments/styles"/>

<body class="layout-sticky-subnav layout-default ">

<th:block th:replace="fragments/preloader"/>

<div class="mdk-header-layout js-mdk-header-layout">

    <th:block th:replace="fragments/navbar"/>

    <!-- Header Layout Content -->
    <div class="mdk-header-layout__content page-content ">

        <div class="pt-32pt">
            <div
                    class="container page__container d-flex flex-column flex-md-row align-items-center text-center text-sm-left">
                <div class="flex d-flex flex-column flex-sm-row align-items-center">

                    <div class="mb-24pt mb-sm-0 mr-sm-24pt">
                        <ol class="breadcrumb p-0 m-0">
                            <li class="breadcrumb-item"><a href="/index">Home</a></li>
                            <li class="breadcrumb-item active">Report</li>
                        </ol>
                        <h2 class="mb-0" th:text="${scenario.title}"></h2>
                    </div>
                </div>

            </div>
        </div>

        <div class="container page__container page-section">

            <div class="page-separator">
                <div class="page-separator__text">시나리오 보안 검사 실패 통계</div>
            </div>
            <div class="row mb-lg-8pt">
                <div class="col-lg-12">
                    <div class="card">
                        <div class="card-body p-24pt">
                            <div class="row">
                                <div class="col-lg-2"></div>
                                <div class="col-lg-8">
                                    <div id="pie-chart"></div>
                                </div>
                                <div class="col-lg-2"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="page-separator">
                <div class="page-separator__text">인증 기록</div>
            </div>

            <div class="card mb-0">
                <div data-toggle="lists"
                     data-lists-values='[
                          "js-lists-values-course",
                          "js-lists-values-revenue",
                          "js-lists-values-fees"
                     ]'
                     data-lists-sort-by="js-lists-values-revenue"
                     data-lists-sort-desc="true" class="table-responsive">
                    <table class="table table-nowrap table-flush">
                        <thead>
                        <tr class="text-uppercase small">
                            <th class="text-center" style="width: 200px">
                                <a href="javascript:void(0)">인증 일시</a></th>
                            <th class="text-center"><a href="javascript:void(0)">스테이지</a></th>
                            <th class="text-center" style="width: 200px">
                                <a href="javascript:void(0)">기능 검사</a></th>
                            <th class="text-center" style="width: 200px">
                                <a href="javascript:void(0)">보안 검사</a></th>
                        </tr>
                        </thead>

                        <tbody class="list">

                            <tr th:each="stageLog : ${member.getStageLogList}">
                                <td class="text-center text-70">
                                    <span th:text="${#temporals.format(stageLog.createTime, 'yyyy-MM-dd HH:mm')}"></span>
                                </td>
                                <td>
                                    <div class="media flex-nowrap align-items-center">
                                        <div class="media-body">
                                            <a class="text-body js-lists-values-course"
                                               th:href="|/scenarios/${scenario.subTitle}/report/detail/${stageLog.id}|">
                                                <strong th:text="|Stage.${stageLog.stage.no} - ${stageLog.stage.title}|"></strong>
                                            </a>
                                        </div>
                                    </div>
                                </td>
                                <th:block th:with="testCategoryLogList = ${stageLog.getTestCategoryLogList}">
                                    <td th:each="testCategoryLog : ${testCategoryLogList}"  class="text-center text-70">
                                        <th:block th:if="${testCategoryLog.result == validResultEnum[0]}">
                                            <span th:text="|통과 (${testCategoryLog.testScenarioPassCount} / ${testCategoryLog.testScenarioCount})|"></span>
                                        </th:block>
                                        <th:block th:if="${testCategoryLog.result == validResultEnum[1]}">
                                            <span th:text="|실패 (${testCategoryLog.testScenarioPassCount} / ${testCategoryLog.testScenarioCount})|" style="color:red;"></span>
                                        </th:block>
                                    </td>
                                </th:block>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>
    <!-- // END Header Layout Content -->

    <th:block th:replace="fragments/footer"/>

</div>

<th:block th:replace="fragments/drawer"/>

<th:block th:replace="fragments/scripts"/>

<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/data.js"></script>
<script src="https://code.highcharts.com/modules/drilldown.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>


<script th:inline="javascript">



Highcharts.chart('pie-chart', {
    chart: {
        type: 'pie'
    },
    title: {
        text: '취약점별 검사 실패 횟수',
        style: {
            fontWeight: 'bold'
        }
    },
    subtitle: {
        text: '영역을 클릭하시면 스테이지별 통계를 확인할 수 있습니다.',
    },

    accessibility: {
        announceNewData: {
            enabled: true
        },
        point: {
            valueSuffix: '%'
        }
    },

    plotOptions: {
        series: {
            dataLabels: {
                enabled: true,
                format: '{point.name}: {point.y}번'
            }
        }
    },

    tooltip: {
        headerFormat: '<span style="font-size:11px">{series.name}</span><br>',
        pointFormat: '<span style="color:{point.color}">{point.name}</span>: <b>{point.y}번</b> of total<br/>'
    },

    series: [
        {
            name: "취약점",
            colorByPoint: true,
            data: [
                {
                    name: "백업 파일 존재",
                    y: 1,
                    drilldown: "백업 파일 존재"
                },
                {
                    name: "인증 우회 취약점",
                    y: 3,
                    drilldown: "인증 우회 취약점"
                },
                {
                    name: "SQL Injection 취약점",
                    y: 17,
                    drilldown: "SQL Injection 취약점"
                },
                {
                    name: "XSS 취약점",
                    y: 13,
                    drilldown: "XSS 취약점"
                },
                {
                    name: "파일 다운로드 취약점",
                    y: 3,
                    drilldown: "파일 다운로드 취약점"
                }
            ]
        }
    ],
    drilldown: {
        series: [
            {
                name: "백업 파일 존재",
                id: "백업 파일 존재",
                data: [
                    [ "회원가입 및 로그인", 1 ],
                    [ "게시물 작성", 0 ],
                    [ "게시판", 0 ],
                    [ "게시물 수정 및 삭제", 0 ],
                    [ "게시판 검색", 0 ],
                    [ "비밀 게시물", 0 ],
                    [ "파일 업로드 및 다운로드", 0 ],
                ]
            },
            {
                name: "인증 우회 취약점",
                id: "인증 우회 취약점",
                data: [
                    [ "회원가입 및 로그인", 1 ],
                    [ "비밀 게시물", 2 ],
                ]
            },
            {
                name: "SQL Injection 취약점",
                id: "SQL Injection 취약점",
                data: [
                    [ "회원가입 및 로그인", 4 ],
                    [ "게시물 작성", 5 ],
                    [ "게시물 수정 및 삭제", 5 ],
                    [ "게시판 검색", 3 ],
                ]
            },
            {
                name: "XSS 취약점",
                id: "XSS 취약점",
                data: [
                    [ "게시물 작성", 6 ],
                    [ "게시물 수정 및 삭제", 4 ],
                ]
            },
            {
                name: "파일 다운로드 취약점",
                id: "파일 다운로드 취약점",
                data: [
                    [ "파일 업로드 및 다운로드", 3 ],
                ]
            },
        ]
    }
});





Highcharts.chart('polygon-chart', {

    chart: {
        polar: true,
        type: 'line'
    },
    title: {
        text: ''
    },


    xAxis: {
        categories: [
            '백업 파일 존재',
            '인증 우회 취약점',
            'SQL Injection 취약점',
            'XSS 취약점',
            '파일 다운로드 취약점'
        ],
        tickmarkPlacement: 'on',
        lineWidth: 0
    },

    yAxis: {
        gridLineInterpolation: 'polygon',
        lineWidth: 0,
        min: 0
    },

    tooltip: {
        shared: true,
        pointFormat: '<span style="color:{series.color}">{series.name}: <b>{point.y}번</b><br/>'
    },

    legend: {
        align: 'right',
        verticalAlign: 'middle',
        layout: 'vertical'
    },

    series: [
    {
        name: '총 스테이지 실패 횟수',
        data: [1, 5, 19, 12, 3],
        pointPlacement: 'on',
        color: 'rgba(223, 83, 83)',
        visible: false
    },
    {
        name: '회원가입 및 로그인',
        data: [1, 1, 4, 0, 0],
        pointPlacement: 'on'
    },
    {
        name: '게시물 작성',
        data: [0, 1, 2, 4, 0],
        pointPlacement: 'on'
    },
    {
        name: '게시판',
        data: [0, 0, 3, 0, 0],
        pointPlacement: 'on'
    },
    {
        name: '게시물 수정 및 삭제',
        data: [0, 1, 5, 4, 0],
        pointPlacement: 'on'
    },
    {
        name: '게시판 검색',
        data: [0, 0, 2, 2, 0],
        pointPlacement: 'on'
    },
    {
        name: '비밀 게시물',
        data: [0, 1, 0, 0, 0],
        pointPlacement: 'on'
    },
    {
        name: '파일 업로드 및 다운로드',
        data: [0, 1, 3, 2, 3],
        pointPlacement: 'on'
    },
    ],

    responsive: {
        rules: [{
            condition: {
                maxWidth: 500
            },
            chartOptions: {
                legend: {
                    align: 'center',
                    verticalAlign: 'bottom',
                    layout: 'horizontal'
                },
                pane: {
                    size: '80%'
                }
            }
        }]
    }

});


</script>

</body>
</html>